if not getgenv then return end

getgenv().BlackAir = getgenv().BlackAir or {}
getgenv().BlackAir.AutoExec = getgenv().BlackAir.AutoExec or false

local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- LINK ZUM TRASHCAN SCRIPT
local TRASH_SCRIPT_LINK = "https://raw.githubusercontent.com/TeamB-dot/main/refs/heads/main/main"

-- queue_on_teleport detection
local q = queue_on_teleport or queue_on_teleport_internal or (syn and syn.queue_on_teleport)

local function queueNextServer()
    if getgenv().BlackAir.AutoExec and q then
        q([[
            repeat task.wait() until game:IsLoaded()
            loadstring(game:HttpGet("]] .. TRASH_SCRIPT_LINK .. [[", true))()
        ]])
    end
end

-- ============================================================
--   RAYFIELD GUI (FEHLERFREI)
-- ============================================================

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "BlackAir Auto Farm",
   LoadingTitle = "BlackAir Auto Farm",
   LoadingSubtitle = "TrashCan Automation",
})

-- ❗ WICHTIG: ICON MUSS EINE NUMBER SEIN (KEINE STRING)
local Tab = Window:CreateTab("Farm", 4483362458)

-- Toggle für AutoExec
Tab:CreateToggle({
    Name = "AutoExec",
    CurrentValue = getgenv().BlackAir.AutoExec,
    Callback = function(val)
        getgenv().BlackAir.AutoExec = val
    end,
})

-- Start Trashcan Script
Tab:CreateButton({
    Name = "Start Trashcan Farm",
    Callback = function()
        loadstring(game:HttpGet(TRASH_SCRIPT_LINK))()
    end
})

-- Server Hop Button
Tab:CreateButton({
    Name = "Server Hop",
    Callback = function()
        if getgenv().BlackAir.AutoExec then
            queueNextServer()
        end
        TeleportService:Teleport(game.PlaceId)
    end
})
